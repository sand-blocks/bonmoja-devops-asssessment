# SOLUTION.md

[LINK TO DIAGRAM](https://viewer.diagrams.net/index.html?tags=%7B%7D&lightbox=1&highlight=0000ff&edit=_blank&layers=1&nav=1&dark=auto#R%3Cmxfile%3E%3Cdiagram%20name%3D%22Page-1%22%20id%3D%22TJd0V1OkotOOeHoEwwON%22%3E5Z1fc6M2EMA%2FjWfah8sgJIF4dJxcrzPX1ndOe21fOjLINnMYXIyTuJ%2B%2BEn9sQLKNW4ScNplJwoII%2Fu1qtbtaJyM4Wb9%2Bl9LN6ockYNHItoLXEXwY2bZtQZd%2FE5J9IQHAtQrJMg2DUnYUzMK%2FWCmsLtuFAds2LsySJMrCTVPoJ3HM%2FKwho2mavDQvWyRR87du6JJJgplPI1n6JQyyVSEltnuUf2DhclX9ZuB4xZk1rS4uX8l2RYPkpSaCjyM4SZMkK35av05YJOhVXIpx70%2BcPTxYyuKsy4A%2F0K%2BzcfTlQ%2FD6y097y97ZMHx8V97lmUa78gV%2FP%2F6BCz4nEadePHe2r2C8rMKMzTbUF8cvXOMjeL%2FN0uTrgQ1%2FVfeLMIomSZSk%2BSDIQICZe7iydsZzXEgdfqZ8CJZm7PXkqwMHZtzaWLJmWbrnl5QDcEm5sjOrErwctYY8u5CtahqDsLyQlpayPNz7CJP%2FUPK8gq0tsZ0xf5eGmXjs79Jkt%2BmJ8IL4zPdVhOcEIw6iH8KOfRkxgYMihhLiSZTsgi8081c9scXiU8iTOKvJiw8Vcyf%2F6Ic5cCoHWkG3XSJBdxGRoXMfpQk6kqA%2FTmZcMIl224yl%2FXDnPoMESMWX2HPYG18Emn4DK2zaQa6M1yFEE14s4f1lyu9kfQOsu%2FyT3xU43%2FZk3ouFrXYdgTN3cE%2BYbRfgBmZEZCsmliNjBpbnaOLsSJzHzzSM6DyMChf9exIz%2Fu2%2BJ4OmjCyUpB2fsPmiL9KwSRpYLpYXQoRk1IhgTaTdjqTHb4k0BB65TBpaivUQEaSJNJFIfx9zlxyzTELL4484YOJmgANRgaapX8bjeQghc%2B%2FDXokFGhQhkR2w6yliCk8TQk9CON3No9DnstlunpPkngMCgST3yMACuU%2B20T803z6MEVqtOAFhR%2BIIsAKkq2sdq1bWOsk0fKYZO43SPEiOsgkSWLJBAgcPCVJO0i6apG2cpO06rZQMKELXgU1STskumaR5kNACqAPIYU1STrx%2BHD%2BJtJazfKF7g2bneS2zg55iAmNFxoR1rcpAzpiOy%2FINIHNbxRNcqbdOrEonhyEmJ0HjzYa7PJqFScxPfExoIGJzGtHYFznnYdZ%2BM01SgZVY%2FzRF6gEpn43NsAY5shFy4ZBTVs53irR9xtLnkBOpIXxP0yW3SqMAPXLXzGRcqJrHYEiEciLzRLdfueSBLcI4LGzziHGVZZt3zF8lo7w%2BndEwZqlJqKiyuBKp59qyVVoK16gPqZyxPE4%2Bc8Fntkm2YZakBh2jxAsApLBBV7Hy6vOMcn7y%2BUFM42myzZYpm336WDfBYH6Xwbt16KfJtzV56SMxqsq1RtYd4DQDG%2BIq6BIFXVBl1f3X7OWk5WEf03XywF%2Bx9UTnUcNRTun%2B3Yal71L2545tM4NzW5SKm%2B4SdISpbW7bct4y%2ByRM9dOOcYFBVKSd41WJQZ2VanXWNq1tOTOZ%2FShYPSUbkegZY4UkVo6isAAV9UR9rOTkY%2FTeGnnvRx4cjV2x2K5oGoXxmqZZGI%2BQtVzTMLrzk7VJkLCdlyiMzq7CxGEmqJyXfEyWo3Jzsubn%2BN2Zv%2BVfaxGNuciwCloOIC1FuuIMGRjacrpSLMqT6c%2F86zii6bq%2BbPCfl%2FyZ7kWtkw%2B1FkkqVuN1GJuMDj3odADrKjbD9IGVk5ZiCXlgG%2F5EZ9DmZbsSLLDMkpXWZjVZMmQ6aCs2ZT6KGKfdo1CH%2B%2BHpaTqCY5KjTYU7tY57kibzbey1yt%2Bqqq0Nh8xsbFVmM7sAuIrLHfFYFWKuF4NoCcEd0IJB161TOVAXtHnKU6HlGjHpcQHqxFYRXGljC%2BUEqDDbx1cOt6y%2Bie6wOts8ZRc9CsfuG5MW2wWqNWQmBOVMqIBalo%2FaPPM1TvDkOYBBkBC1d3CUe2FDBgRVvaIe%2B7f5cB%2FwfNjY3mY8CRiLRlAuiEWfAbxncVBJ5lHifxWi1zD7lR9bd7g8%2Bi0%2F8rz8ev7otbPiMD%2FND47b6Mc2OxZIPaUt5Px5k13qszOvtCTIH3%2FJsjPXFd5B1mHKIpqFz80HUekjH8p5iC2IwwWbJIyzraSuw%2F3%2FhQYV2Zs%2BDYK6%2BkBDeXcI6NRf5bUvKxDrVWB556kQ1GJSgpo7FLhsjj2qu7hlv8qXM85elQ8akzdvX6tNXocMNnurDayL2vdMKB%2BiVpeD2%2B4dvzQAoHJN02sucl6t01yM%2BfrO1gJOLNjafYV3zlw0KV%2FO%2FTUq34NN5VvecNqHN%2B0rDu13h6lfNuqedBbyiEGchVzRMBRYAKjVXKyuzgIasRcIWmXEKhvQq3253DKU9gddKewbUX7vaYFc0%2FlP6q%2FzSu%2B8Lf0huW7Us%2F6Ie1KBrbwOa9Wg01WDll4Nqt0vOLwD79BUAc%2Bu1tKAw%2FsYtPrrKvvUZy%2Bu98bsxTZjL%2BBaewFG7EV34e9Gyn7dzcU1Yi4OgOfMRZPyzdUMB9W921X35I0FB5rLfnzCnlZgKze7jclrJJUHBJ%2F19Zom77BFPGxs9no3HRjKebllD7FuD1rFw%2B7ta99ImAetqiFuWO1rr8mRrlE%2BtG9i6T615a7Z87vtpsmW%2BruMGCTM117G81BXg%2FFuw2DMpIWud7XBSCMGMZj%2FR92welWXzeWN1X2x9rohvgkFdk4NbM39PKdmr4nUoHr35n988naODW3NrUC9T17dRbnb0F914WX9vbFNG3xtXS2g21XjYEoz8YcMRqLn1Lbgv627OsamaNd9OdtI2dVt5e6DNODga6t2uq3DbfTotJouNOd3nZdvzaXZE8s3cttvpb6wi9MeMEy0jq%2BtBeo2KYM9f52DAjO1YrsVEA5TMMLXlgs1GMid5ZyKOtod5HobvbqWCKCZTgME2y7kUolAHjGI07m2CKnDpgB4YzZlpk6J8NU2JY0YxKY01ylb2xpnypRy80p%2B8uG1cbSvrXzHU%2BJgr8HIOgdLhlqkWn%2FJnJAztQ5VA0zzzcYEt97tVgAqh52zXQ81H8QDrTsVBKU7XbZifnj8zwLF5cd%2F0AAf%2FwY%3D%3C%2Fdiagram%3E%3C%2Fmxfile%3E#%7B%22pageId%22%3A%22TJd0V1OkotOOeHoEwwON%22%7D)


## Overview & Rationale

The goal of this assessment is to simulate a simple messaging system using a HTTP workload while covering a broad array of AWS components to deploy the solution (networking, containers, databases, communication, observability, CI/CD pipelines by ways of Github). The app uses `hashicorp/http-echo` as a base image to demonstrate the expected application so we can focus on cloud infrastructure and operations.

## Key design decisions:
- **VPC**: 10.0.0.0/16 Allows more than enough IPs for our simulated application, Public and Private subnets implemented to maintain security scope.
- **ECS on Fargate**: Serverless container runtime with minimal overhead. Good fit for a stateless demo service with an **ALB** to handle the ingress.
- **RDS PostgreSQL**: Common relational DB in private subnets (not publicly accessible). Security groups restrict access.
- **DynamoDB**: On-demand datastore for flexible key-value/session metadata without capacity planning.
- **SQS/SNS**: Decoupled async Pub/Sub messaging services and fan-out/notifications.
- **CloudWatch**: Logs, metrics, alarms for basic observerability.
- **Terraform**: Declarative IaC which maintains state.
- **GitHub Actions**: CI/CD workflow handled using OIDC.

## Security notes
- **Least privilege IAM**:
  - ECS **execution role** scoped to ECR pulls, logs.
  - ECS **task role** scoped to DynamoDB table, SQS queue, SNS topic only (CRUD as needed).
- **Network segmentation**:
  - RDS in **private subnets** only; SG allows ingress from ECS tasks SG on 5432.
  - ALB in **public subnets** exposes only HTTP/80 inbound; forwards to ECS target group on 5678. 
- **No public DB** endpoints; NAT for egress from private subnets.

## Monitoring & alerting
- **Log groups** for ECS tasks.
- **Alarms**:
  - `RDS CPU > 80% for 5m` – catches runaway queries or sizing issues.
  - `SQS depth > 100 for 10m` – signs of backlog/ lack of resources.

## CI/CD
- **Plan**: build image, push to ECR, validate/apply Terraform, update ECS service with new task def, run health check.
- **Deployment safety**:
  - Infra changes gated by Terraform plan in PRs (extend workflow for manual approvals in prod).

## Cost optimization

**TODO**
- NB: Budgets should be setup for the entire project to track costs

**Actionable strategies**
1. **Use Fargate Spot for ECS tasks** (up to ~70% savings). *Trade-off*: Interruption risk; use for non-critical/HA stateless services.
2. **DynamoDB On-Demand** vs Provisioned with Auto Scaling based on access patterns.
3. **One NAT Gateway per AZ vs Single NAT**: Single NAT reduces cost but reduces AZ resilience.

## Future work TODOs
- Refactor Terraform and create modules for all resources, would make maintaining and readibility way better
- Add **Route53 + TLS** via ACM, HTTPS on ALB.
- Add **autoscaling** policies for ECS on CPU/ReqPerTarget.
- Blue/Green with **CodeDeploy** for zero-downtime deploys.
- RDS replica set / Multi-AZ for HA.
- Terraform **remote backend** (S3 bucket).
- Health script to send notifications to obs team on failures
- Rollback strategies for when things go wrong